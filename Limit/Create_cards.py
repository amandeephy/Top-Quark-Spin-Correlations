from   tqdm import tqdm

def main() :
    # Obtained from Automate combine shape 
    # 3000 fb-1
    # SUSY_count_dict = {('145', '1'): 5478827.708251953, ('155', '10'): 3827206.9107666016, ('155', '1'): 4288185.037902832, ('165', '10'): 3369246.7555236816, ('165', '1'): 3766657.964477539, ('165', '20'): 2813265.9610061646, ('175', '10'): 3033943.333465576, ('175', '1'): 4188650.381072998, ('175', '20'): 2505527.6845855713, ('175', '30'): 2114748.258670807, ('185', '10'): 3146325.022544861, ('185', '1'): 3155311.7598876953, ('185', '20'): 2350647.0078125, ('185', '30'): 1908412.8521881104, ('185', '40'): 1581290.58618927, ('195', '10'): 2353993.0283527374, ('195', '1'): 2357115.116004944, ('195', '20'): 2337882.992553711, ('195', '30'): 1749993.6155853271, ('195', '40'): 1423953.7694797516, ('195', '50'): 1199537.9789524078, ('205', '10'): 1792736.9494476318, ('205', '1'): 1794658.041885376, ('205', '20'): 1772294.973449707, ('205', '30'): 1754488.289428711, ('205', '40'): 1351658.1194458008, ('205', '50'): 1107635.0993347168, ('205', '60'): 920529.4299468994, ('215', '10'): 1371582.2446289062, ('215', '20'): 1376594.9959640503, ('215', '30'): 1408668.9530563354, ('215', '40'): 1381764.4486160278, ('215', '50'): 1042050.8310012817, ('215', '60'): 869344.9577522278, ('215', '70'): 727596.910987854, ('225', '20'): 1086020.969447136, ('225', '30'): 1089242.9266338348, ('225', '40'): 1056630.3727884293, ('225', '50'): 1061329.7223205566, ('225', '60'): 815470.5001678467, ('225', '70'): 673012.6715927124, ('225', '80'): 568652.5786476135, ('235', '30'): 847376.7258558273, ('235', '40'): 830983.7768659592, ('235', '50'): 814438.2888774872, ('235', '60'): 829128.4449119568, ('235', '70'): 633772.531255722, ('235', '80'): 524397.1240186691, ('235', '90'): 441097.94634246826, ('245', '100'): 341097.3087692261, ('245', '40'): 665372.3302574158, ('245', '50'): 666722.2626972198, ('245', '60'): 655798.2056293488, ('245', '70'): 637636.3724250793, ('245', '80'): 501542.22271347046, ('245', '90'): 414222.2284221649, ('255', '100'): 330688.5728607178, ('255', '50'): 518739.52893066406, ('255', '60'): 514335.35003089905, ('255', '70'): 513227.9060745239, ('255', '80'): 495730.44633102417, ('255', '90'): 402842.2154312134, ('265', '100'): 306448.39526844025, ('265', '60'): 405454.4694314003, ('265', '70'): 412592.1228694916, ('265', '80'): 405918.5969657898, ('265', '90'): 400960.9124507904, ('275', '100'): 315687.65634536743, ('275', '70'): 314364.90839767456, ('275', '80'): 317459.09439849854, ('275', '90'): 320471.6942214966, ('285', '100'): 250307.6949710846, ('285', '80'): 251317.47439336777, ('285', '90'): 256805.3918018341, ('295', '90'): 201663.1744003296, ('300', '135'): 148321.9256734848, ('300', '145'): 116947.80766487122, ('300', '155'): 96833.27422523499, ('350', '195'): 54572.68160820007, ('350', '205'): 45970.43390703201, ('400', '195'): 47869.70586204529, ('400', '205'): 46286.112298965454, ('400', '215'): 46062.55902671814, ('400', '225'): 46038.55619049072, ('400', '235'): 34782.44597887993, ('400', '245'): 27396.243326425552, ('400', '255'): 22822.166845321655, ('450', '245'): 24942.65345954895, ('450', '275'): 24121.53799200058, ('450', '285'): 18435.96609401703, ('450', '295'): 14935.34779214859, ('450', '305'): 12599.800435066223, ('500', '305'): 13938.424834251404, ('500', '315'): 13393.369226694107, ('500', '325'): 13438.337576389313, ('500', '335'): 10151.984554290771, ('500', '345'): 8496.43361377716, ('500', '355'): 6820.053460121155, ('550', '355'): 8192.728106498718, ('550', '375'): 7895.707258820534, ('550', '385'): 5918.778338313103, ('550', '395'): 4931.496009588242, ('550', '405'): 4071.1069275140762, ('600', '445'): 2961.8187779188156, ('650', '475'): 2874.206689476967, ('650', '485'): 2243.2002353966236, ('650', '495'): 1819.8415745794773, ('650', '505'): 1525.8830782175064, ('700', '505'): 1910.6197198033333, ('700', '515'): 1872.75589376688, ('700', '525'): 1836.738018155098, ('700', '535'): 1408.4431037902832, ('700', '545'): 1153.388068497181, ('700', '555'): 985.4696657657623, ('750', '545'): 1264.4647489339113, ('750', '555'): 1255.531451895833, ('750', '565'): 1217.0779065191746, ('750', '575'): 1212.5076254680753, ('750', '585'): 933.6816771924496, ('750', '595'): 750.9345874786377, ('750', '605'): 648.1913084238768, ('800', '595'): 839.266265898943, ('800', '605'): 814.9250493645668, ('800', '615'): 814.6172025203705, ('800', '625'): 781.1714144796133, ('800', '635'): 627.8163579404354, ('800', '645'): 516.2261539697647, ('800', '655'): 415.55717009305954, ('850', '645'): 555.0500126853585, ('850', '655'): 552.4329049885273, ('850', '665'): 522.7728361487389, ('850', '675'): 529.8535762503743, ('850', '685'): 408.74518394470215, ('850', '695'): 334.7342209815979, ('850', '705'): 280.8676344156265, ('900', '695'): 379.3336240798235, ('900', '705'): 378.39302295446396, ('900', '715'): 366.1338002085686, ('900', '725'): 356.1054437607527, ('900', '735'): 280.68883261084557, ('900', '745'): 227.88987347483635, ('900', '755'): 197.0529959835112}

    # 30 fb-1
    SUSY_count_dict = {('145', '1'): 54788.27761745453, ('155', '10'): 38272.06913423538, ('155', '1'): 42881.84920501709, ('165', '10'): 33692.467027425766, ('165', '1'): 37666.57909679413, ('165', '20'): 28132.658713698387, ('175', '10'): 30339.43273115158, ('175', '1'): 41886.50376367569, ('175', '20'): 25055.276851654053, ('175', '30'): 21147.482865333557, ('185', '10'): 31463.24938750267, ('185', '1'): 31553.117520213127, ('185', '20'): 23506.469831228256, ('185', '30'): 19084.128355145454, ('185', '40'): 15812.906107872725, ('195', '10'): 23539.93033003807, ('195', '1'): 23571.150965631008, ('195', '20'): 23378.830819129944, ('195', '30'): 17499.935825824738, ('195', '40'): 14239.538104116917, ('195', '50'): 11995.379999697208, ('205', '10'): 17927.369116440415, ('205', '1'): 17946.57927723229, ('205', '20'): 17722.949461728334, ('205', '30'): 17544.882831275463, ('205', '40'): 13516.581493884325, ('205', '50'): 11076.351066365838, ('205', '60'): 9205.293970823288, ('215', '10'): 13715.822327971458, ('215', '20'): 13765.950066357851, ('215', '30'): 14086.689899235964, ('215', '40'): 13817.644540458918, ('215', '50'): 10420.508267819881, ('215', '60'): 8693.449384227395, ('215', '70'): 7275.96897906065, ('225', '20'): 10860.209152191877, ('225', '30'): 10892.428746283054, ('225', '40'): 10566.303543239832, ('225', '50'): 10613.297254949808, ('225', '60'): 8154.705054670572, ('225', '70'): 6730.1267893612385, ('225', '80'): 5686.5256226062775, ('235', '30'): 8473.767277479172, ('235', '40'): 8309.83769774437, ('235', '50'): 8144.383015215397, ('235', '60'): 8291.284352302551, ('235', '70'): 6337.725352525711, ('235', '80'): 5243.971060454845, ('235', '90'): 4410.979450285435, ('245', '100'): 3410.9730631113052, ('245', '40'): 6653.723640799522, ('245', '50'): 6667.222963564098, ('245', '60'): 6557.9821347519755, ('245', '70'): 6376.363679274917, ('245', '80'): 5015.422103270888, ('245', '90'): 4142.222180642188, ('255', '100'): 3306.8857538849115, ('255', '50'): 5187.395407900214, ('255', '60'): 5143.353566214442, ('255', '70'): 5132.279248028994, ('255', '80'): 4957.304427027702, ('255', '90'): 4028.4221398830414, ('265', '100'): 3064.4839823544025, ('265', '60'): 4054.5446909070015, ('265', '70'): 4125.921393021941, ('265', '80'): 4059.185936689377, ('265', '90'): 4009.6090497225523, ('275', '100'): 3156.8765438497066, ('275', '70'): 3143.6491820961237, ('275', '80'): 3174.5908897593617, ('275', '90'): 3204.7168881371617, ('285', '100'): 2503.076953113079, ('285', '80'): 2513.174774285406, ('285', '90'): 2568.0539139956236, ('295', '90'): 2016.6317413449287, ('300', '135'): 1483.2192633152008, ('300', '145'): 1169.4780995249748, ('300', '155'): 968.3327478319407, ('350', '195'): 545.7268122732639, ('350', '205'): 459.70434368401766, ('400', '195'): 478.6970594152808, ('400', '205'): 462.8611264899373, ('400', '215'): 460.62558948993683, ('400', '225'): 460.38556660711765, ('400', '235'): 347.8244616612792, ('400', '245'): 273.96244083717465, ('400', '255'): 228.2216773480177, ('450', '245'): 249.42653174698353, ('450', '275'): 241.21538094058633, ('450', '285'): 184.3596605323255, ('450', '295'): 149.35347869247198, ('450', '305'): 125.99800380319357, ('500', '305'): 139.38424728810787, ('500', '315'): 133.93369338288903, ('500', '325'): 134.38337743282318, ('500', '335'): 101.51984705775976, ('500', '345'): 84.96433566138148, ('500', '355'): 68.20053594186902, ('550', '355'): 81.92728006653488, ('550', '375'): 78.9570721462369, ('550', '385'): 59.18778274767101, ('550', '395'): 49.31496019102633, ('550', '405'): 40.71107002906501, ('600', '445'): 29.618187422398478, ('650', '475'): 28.7420671582222, ('650', '485'): 22.43200265010819, ('650', '495'): 18.198416087776423, ('650', '505'): 15.258830734528601, ('700', '505'): 19.10619719326496, ('700', '515'): 18.727558742742985, ('700', '525'): 18.367380414623767, ('700', '535'): 14.084431357681751, ('700', '545'): 11.533880705479532, ('700', '555'): 9.854696805588901, ('750', '545'): 12.644647626788355, ('750', '555'): 12.555314600467682, ('750', '565'): 12.170779486186802, ('750', '575'): 12.12507622630801, ('750', '585'): 9.336816844996065, ('750', '595'): 7.509345888160169, ('750', '605'): 6.481913134455681, ('800', '595'): 8.392662649508566, ('800', '605'): 8.149250329937786, ('800', '615'): 8.14617204386741, ('800', '625'): 7.81171406514477, ('800', '635'): 6.27816349605564, ('800', '645'): 5.162261491641402, ('800', '655'): 4.155571822077036, ('850', '645'): 5.550500187266152, ('850', '655'): 5.524328862840775, ('850', '665'): 5.227728461846709, ('850', '675'): 5.29853591643041, ('850', '685'): 4.087451804894954, ('850', '695'): 3.347342187538743, ('850', '705'): 2.8086764633189887, ('900', '695'): 3.7933362438343465, ('900', '705'): 3.783930109348148, ('900', '715'): 3.661338096950203, ('900', '725'): 3.5610545001691207, ('900', '735'): 2.8068883367814124, ('900', '745'): 2.2788987058447674, ('900', '755'): 1.9705299721972551}

    stop_masses     = [ms for (ms, _) in SUSY_count_dict.keys()]
    chi0_masses     = [mc for (_ ,mc) in SUSY_count_dict.keys()]
    SUSY_counts     = [c  for c in SUSY_count_dict.values()] 

    # 3000 fb-1
    # tt_count = 14357618.61
    # st_count = 549058.32 
    # vv_count = 40584.79

    # 30 fb-1
    tt_count = 142389.60
    st_count = 5490.58
    vv_count = 405.84
  
    for i in tqdm(range(len(SUSY_count_dict))) :

        mstop = stop_masses[i]
        mchi0 = chi0_masses[i]
        
        card_name  = 'Mstop_' + str(mstop) + '_mchi0_' + str(mchi0) + '_combine_card_30fb'
        shape_file = 'Mstop_' + str(mstop) + '_mchi0_' + str(mchi0) + '_sig_pred_shape_30fb.root'
        
        print('Working on card :: ' + str(card_name))

        with open(card_name, 'w') as op_file :
            op_file.write("imax 1  number of channels")
            op_file.write("\n")
            op_file.write("jmax 3  number of backgrounds")
            op_file.write("\n")
            op_file.write("kmax 9  number of nuisance parameters (sources of systematic uncertainties)")
            op_file.write("\n")

            op_file.write("\n")
            op_file.write("---------------")
            op_file.write("\n")
            op_file.write("shapes * * " + str(shape_file) + " $PROCESS  $PROCESS_$SYSTEMATIC")
            op_file.write("\n")
            op_file.write("---------------")
            op_file.write("\n")

            op_file.write("\n")
            op_file.write("bin          bin1       bin1        bin1       bin1")
            op_file.write("\n")
            op_file.write("process      SUSY       ttbar       st         vv")
            op_file.write("\n")
            op_file.write("process      0          1           2          4")
            op_file.write("\n")
            op_file.write("rate         " + str(round(SUSY_counts[i],2)) + "       " + str(tt_count) + "    " + str(st_count) + "    " +  str(vv_count))
            op_file.write("\n")

            op_file.write("\n")   
            op_file.write("Xsection lnN  1.07       1.03       1.03      1.03")
            op_file.write("\n")
            op_file.write("Scale    lnN  1.01       1.01       1.01      1.01")
            op_file.write("\n")
            op_file.write("PDF      lnN  1.01       1.01       1.01      1.01")
            op_file.write("\n")
            op_file.write("Lumi     lnN  1.02       1.02       1.02      1.02")
            op_file.write("\n")
            op_file.write("Lep_id   lnN  1.01       1.01       1.01      1.01")
            op_file.write("\n")
            op_file.write("B-tag    lnN  1.01       1.01       1.01      1.01")
            op_file.write("\n")
            op_file.write("jer      lnN  1.03       1.05       1.01      1.01")
            op_file.write("\n")
            op_file.write("jes      lnN  1.03       1.05       1.01      1.01")    
            op_file.write("\n")
            op_file.write("top-pt   lnN  1.00       1.01       1.00      1.00")    
            op_file.write("\n")

    print('All done')

if __name__ == '__main__' :
    main()